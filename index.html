<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
  <style>
    /* Previous styles remain the same until chart-container */
    body {
      background-color: #1a1a1a;
      color: white;
      font-family: monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background-color: #2a2a2a;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .timer {
      font-size: 2.5rem;
      color: #ffd700;
      margin-bottom: 1rem;
    }

    .text-display {
      font-size: 1.5rem;
      line-height: 1.5;
      margin-bottom: 2rem;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }

    .character {
      color: #666;
    }

    .character.correct {
      color: white;
    }

    .character.incorrect {
      color: #ff4444;
      background-color: rgba(255, 0, 0, 0.2);
    }

    .character.current {
      color: #ffd700;
      border-bottom: 2px solid #ffd700;
    }

    .hidden-input {
      opacity: 0;
      position: absolute;
    }

    .analytics {
      display: none;
      margin-top: 2rem;
    }

    .analytics.show {
      display: block;
    }

    /* Modified chart container styles */
    .chart-container {
      position: relative;
      height: 200px;
      width: 100%;
      margin-bottom: 2rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-top: 2rem;
      text-align: center;
    }

    .stat-box {
      padding: 1rem;
    }

    .stat-value {
      font-size: 2.5rem;
      color: #ffd700;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: #999;
      font-size: 0.9rem;
    }

    .reset-button {
      display: none;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: #ffd700;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: #1a1a1a;
      font-size: 1rem;
    }

    .reset-button:hover {
      background-color: #ffed4a;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="timer">30s</div>
    <div class="text-display"></div>
    <input type="text" class="hidden-input" autocomplete="off">
    <div class="analytics">
      <div class="chart-container">
        <canvas id="wpmChart"></canvas>
      </div>
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-value" id="wpm-value">0</div>
          <div class="stat-label">wpm</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="accuracy-value">0%</div>
          <div class="stat-label">acc</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="raw-value">0</div>
          <div class="stat-label">raw</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="consistency-value">0%</div>
          <div class="stat-label">consistency</div>
        </div>
      </div>
    </div>
    <button class="reset-button" onclick="resetTest()">Reset Test</button>
  </div>

  <script>
    // Previous JavaScript remains the same until createChart function
    const sampleText = `The ability to type quickly and accurately is an essential skill in today's digital world. As technology continues to evolve, keyboards remain our primary interface with computers and devices. Learning to type efficiently can save countless hours and reduce the strain on your hands and wrists. Professional typists often develop a rhythm and flow that makes typing feel as natural as speaking. The best way to improve is through regular practice and proper technique. Focus on accuracy first, and speed will naturally follow as you become more comfortable with the keyboard layout. Many people find that their typing speed plateaus after reaching a certain level. Breaking through this plateau requires conscious effort to identify and eliminate bad habits. Pay attention to your posture and hand position while typing. Keep your wrists elevated and your fingers curved naturally over the home row keys. Your hands should move as little as possible, with each finger responsible for specific keys. Common typing mistakes include looking at the keyboard too often and using improper finger placement. Advanced typists can often achieve speeds of over hundred words per minute while maintaining high accuracy. The key to reaching such speeds is developing muscle memory through consistent practice. Typing tests are an excellent way to measure your progress and identify areas for improvement. They provide immediate feedback on both speed and accuracy. Remember that typing is not just about raw speed, but also about maintaining consistency and preventing errors. The most efficient typists are those who can maintain a steady pace while making very few mistakes. This requires a delicate balance of speed and control.`;

    let timeLeft = 30;
    let timerInterval = null;
    let startTime = null;
    let isFinished = false;
    let wpmHistory = [];
    let chart = null;

    const textDisplay = document.querySelector('.text-display');
    const hiddenInput = document.querySelector('.hidden-input');
    const timerDisplay = document.querySelector('.timer');
    const analyticsDiv = document.querySelector('.analytics');
    const resetButton = document.querySelector('.reset-button');

    // Modified createChart function with fixed dimensions
    function createChart() {
      const ctx = document.getElementById('wpmChart').getContext('2d');
      return new Chart(ctx, {
        type: 'line',
        data: {
          labels: wpmHistory.map(point => point.time),
          datasets: [{
            label: 'WPM',
            data: wpmHistory.map(point => point.wpm),
            borderColor: '#ffd700',
            tension: 0.4,
            borderWidth: 2,
            pointRadius: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: '#333'
              },
              ticks: {
                color: '#666'
              }
            },
            x: {
              grid: {
                color: '#333'
              },
              ticks: {
                color: '#666',
                maxTicksLimit: 10
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          },
          animation: {
            duration: 0
          }
        }
      });
    }

    // Rest of the JavaScript remains the same
    function initializeText() {
      textDisplay.innerHTML = '';
      sampleText.split('').forEach((char, index) => {
        const span = document.createElement('span');
        span.textContent = char;
        span.className = 'character' + (index === 0 ? ' current' : '');
        textDisplay.appendChild(span);
      });
    }

    function startTimer() {
      if (!startTime) {
        startTime = Date.now();
        timerInterval = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = timeLeft + 's';
          
          const elapsedMinutes = (30 - timeLeft) / 60;
          const wordsTyped = hiddenInput.value.length / 5;
          const currentWpm = Math.round(wordsTyped / elapsedMinutes);
          wpmHistory.push({time: 30 - timeLeft, wpm: currentWpm});

          if (timeLeft <= 0) {
            endTest();
          }
        }, 1000);
      }
    }

    function calculateStats() {
      const elapsedMinutes = 0.5;
      const wordsTyped = hiddenInput.value.length / 5;
      const finalWpm = Math.round(wordsTyped / elapsedMinutes);
      
      const correctChars = [...hiddenInput.value].filter((char, i) => char === sampleText[i]).length;
      const accuracy = Math.round((correctChars / hiddenInput.value.length) * 100);

      const wpmValues = wpmHistory.map(point => point.wpm);
      const avgWpm = wpmValues.reduce((a, b) => a + b, 0) / wpmValues.length;
      const variance = wpmValues.reduce((acc, val) => acc + Math.pow(val - avgWpm, 2), 0) / wpmValues.length;
      const consistency = Math.max(0, 100 - (Math.sqrt(variance) / avgWpm) * 100);

      return {
        wpm: finalWpm,
        accuracy,
        raw: finalWpm,
        consistency: Math.round(consistency)
      };
    }

    function endTest() {
      clearInterval(timerInterval);
      isFinished = true;
      hiddenInput.disabled = true;

      const stats = calculateStats();
      
      document.getElementById('wpm-value').textContent = stats.wpm;
      document.getElementById('accuracy-value').textContent = stats.accuracy + '%';
      document.getElementById('raw-value').textContent = stats.raw;
      document.getElementById('consistency-value').textContent = stats.consistency + '%';

      textDisplay.style.display = 'none';
      analyticsDiv.classList.add('show');
      resetButton.style.display = 'block';
      
      if (chart) {
        chart.destroy();
      }
      chart = createChart();
    }

    function resetTest() {
      timeLeft = 30;
      startTime = null;
      isFinished = false;
      wpmHistory = [];
      
      timerDisplay.textContent = '30s';
      hiddenInput.value = '';
      hiddenInput.disabled = false;
      
      textDisplay.style.display = 'block';
      analyticsDiv.classList.remove('show');
      resetButton.style.display = 'none';
      
      initializeText();
      hiddenInput.focus();
    }

    hiddenInput.addEventListener('input', e => {
      if (!startTime && !isFinished) {
        startTimer();
      }

      const value = e.target.value;
      const characters = textDisplay.getElementsByClassName('character');

      const currentChar = textDisplay.querySelector('.character.current');
      if (currentChar) {
        currentChar.classList.remove('current');
      }

      for (let i = 0; i < sampleText.length; i++) {
        if (i < value.length) {
          characters[i].className = 'character ' + 
            (value[i] === sampleText[i] ? 'correct' : 'incorrect');
        } else if (i === value.length) {
          characters[i].className = 'character current';
        } else {
          characters[i].className = 'character';
        }
      }
    });

    document.addEventListener('click', () => {
      if (!isFinished) {
        hiddenInput.focus();
      }
    });

    initializeText();
  </script>
</body>
</html>
